# -*- snakemake -*-
import os
from collections import namedtuple
from snakemakelib.config import update_sml_config, sml_rules_path, BaseConfig, get_sml_config
from snakemakelib.report.sphinx import sphinx_sample_metrics_report
from snakemakelib.utils import utc_time

# Start by including the general snakefile
include: os.path.join(sml_rules_path(), 'bio/ngs', 'settings.rules')

config_default = BaseConfig({ 
    'bio.ngs.report' : BaseConfig({
        'project_id' : "",
        'project_name' : "",
        'basedir' : os.curdir,
        'application':"",
        'date':utc_time(),
        'docroot' : 'sphinx_report',
        'picard' : BaseConfig({
            'columns' : [],
        })
    }),
})

update_sml_config(config_default)

cfg = get_sml_config()

rule sphinx_sample_metrics_report:
    """sphinx: Collect metrics for samples and generate a simple metrics report"""
    input: ["{path}{sep}{sample}".format(path=cfg['bio.ngs.report']['basedir'], sep=os.sep, sample=x) for x in cfg['bio.ngs.settings']['samples']]
    run:
      sphinx_sample_metrics_report(input, cfg['bio.ngs.report'])

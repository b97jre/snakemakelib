# -*- snakemake -*-
import os
from snakemakelib.config import update_sml_config, get_sml_config

# Predefined settings for various platforms
# FIXME: move to module?
platforms = {
    'generic' : {
        'read_group_keys' : (),
        'run_id_re' : (),
    },
    'Illumina' : {
        'read_group_keys' : ("id", "sample", "library", "description", "platform-unit", "center", "date", "platform"),
        'run_id_re' :  (("punit", "date", "flowcell", "sample"), "([0-9])_([0-9]+)_([A-Z0-9]+XX)_(P[0-9]+_[0-9]+)"),
    },
    'PacBio' : {
        'read_group_keys' : (),
        'run_id_re' : (),
    },
    'SOLiD' : {
        'read_group_keys' : (),
        'run_id_re' : (),
    },
}

config_default = { 
    'bio.ngs.settings' : {
        'center' : "",
        'fastq_suffix' : ".fastq",
        'flowcells' : [],
        'flowcellruns' : [],
        'inputdir' : ".",
        'punits' : [],
        'platform' : "generic",
        'read1_label' : "_1",
        'read2_label' : "_2",
        'read1_suffix' : ".fastq.gz",
        'read2_suffix' : ".fastq.gz",
        'regions' : [],
        'samples' : [],
        'sampleinfo' : "", # generic; samplesheet could be Illuminas csv samplesheet; treat elsewhere
        'threads' : 8,
        'annotation' : {
            'annot_label' : "",
            'transcript_annot_gtf' : "",
        },
        'db' : {
            'dbsnp' : "",
            'ref' : "",
            'build' : '',
            'build_config' : None,
        },
        'java' : {
            'java_mem' : "6g",
            'java_tmpdir' : "/tmp",
        },
        'sequence_capture' : {
            'bait_regions' : "",
            'target_regions' : "",
        },
    },
}

update_sml_config(config_default)

ngs_conf = get_sml_config('bio.ngs.settings')

update_sml_config({'bio.ngs.settings' : platforms[ngs_conf['platform']]})

# Add configuration variable to snakemake global config object
config['punits'] = config.get("punits", [])
config['samples'] = config.get("samples", [])
config['regions'] = config.get("regions", []) 
config['flowcells'] = config.get("flowcells", [])  


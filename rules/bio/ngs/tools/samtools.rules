# -*- snakemake -*-
import os
from snakemakelib.utils import update_sml_config, sml_rules_path
import snakemakelib.variables as VAR

# Start by including the general snakefile
include: os.path.join(sml_rules_path(), 'bio/ngs', 'settings.rules')

config_default = { 
    VAR.BIO_NGS_TOOLS_SAMTOOLS : {
        VAR.REF : config[VAR.BIO_NGS_SETTINGS][VAR.DB][VAR.DB],
        VAR.CMD : "samtools",
        VAR.THREADS : config[VAR.BIO_NGS_SETTINGS][VAR.THREADS],
        VAR.OPTIONS : "",
    },
}

config = update_config(config, config_default)

samtools_config = config[VAR.BIO_NGS_TOOLS_SAMTOOLS]

rule samtools_sam2bam:
    params: cmd=samtools_config[VAR.CMD]
    input: "{prefix}.sam"
    output: "{prefix}.bam"
    threads: samtools_config[VAR.THREADS]
    shell: "{params.cmd} view -Sb {input} > {output}"

# -*- snakemake -*-
import os
from snakemakelib.config import update_sml_config, sml_rules_path, BaseConfig, get_sml_config

# Start by including the general snakefile
include: os.path.join(sml_rules_path(), 'bio/ngs', 'settings.rules')

sml_config = get_sml_config()

config_default = BaseConfig({ 
    'bio.ngs.tools.samtools' : BaseConfig({
        'ref' : sml_config['bio.ngs.settings']['db']['ref'],
        'cmd' : "samtools",
        'threads' : sml_config['bio.ngs.settings']['threads'],
        'options' : "",
    }),
})

update_sml_config(config_default)

samtools_config = sml_config['bio.ngs.tools.samtools']

rule samtools_sam2bam:
    params: cmd=samtools_config['cmd']
    input: "{prefix}.sam"
    output: "{prefix}.bam"
    threads: samtools_config['threads']
    shell: "{params.cmd} view -Sb {input} > {output}"

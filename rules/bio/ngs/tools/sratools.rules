# -*- snakemake -*-
import os
from snakemakelib.config import update_sml_config, get_sml_config

include: '../settings.rules'

config_default = { 
    "bio.ngs.tools.sratools" : {
        "home" : ".",
        "fastq-dump" : {
            'cmd' : "fastq-dump",
            "options" : "--split-3 -F",
        }
        'options' : "",,
    },
}

update_sml_config(config_default)

sra_cfg = get_sml_config('bio.ngs.tools.sratools')
ngs_cfg = get_sml_config('bio.ngs.settings')

rule sratools_fastq_dump:
    """Run sratools fastq-dump"""
    params: cmd = sra_cfg['fastq-dump']['cmd'],
            options = sra_cfg['fastq-dump']['options']
    input: "{prefix}.sra"
    output: read1 = "{prefix}" + ngs_cfg["read1_label"] + ngs_cfg["fastq_suffix"],
            read2 = "{prefix}" + ngs_cfg["read2_label"] + ngs_cfg["fastq_suffix"]
    shell: "{params.cmd} {params.options} {input}"

rule sratools_fastq_dump_zip:
    params: cmd = sra_cfg['fastq-dump']['cmd'],
            options = sra_cfg['fastq-dump']['options'] + " --gzip"
    input: "{prefix}.sra"
    output: read1 = "{prefix}" + ngs_cfg["read1_label"] + ngs_cfg["fastq_suffix"] + ".gz",
            read2 = "{prefix}" + ngs_cfg["read2_label"] + ngs_cfg["fastq_suffix"] + ".gz"
    shell: "{params.cmd} {params.options} {input}"

# -*- snakemake -*-
import os
from snakemakelib.utils import update_config, sml_rules_path

# Start by including the general snakefile
include: os.path.join(sml_rules_path(), 'bio/ngs', 'settings.rules')

SECTION="bio.ngs.tools.bedtools"

COVERAGEBED="coverageBed"
BFILE="bfile"

config_default = { 
    SECTION : {
        HOME : ".",
        BFILE : "",
        OPTIONS : "",
        COVERAGEBED : {
            CMD : COVERAGEBED,
        }
    },
}

config = update_config(config, config_default)

rule bedtools_bam2coverage:
    """Calculate coverage for a bam file.

    Input: {prefix}.bam; output: {prefix}.coverage
    """
    params: cmd=os.path.join(config[SECTION][HOME], config[SECTION][COVERAGEBED][CMD]),
            options=config[SECTION][OPTIONS],
            bfile = config[SECTION][BFILE]
    input: "{prefix}.bam"
    output: "{prefix}.coverage"
    shell: "{params.cmd} {params.options} -abam {input} -b {params.bfile} > {output}"

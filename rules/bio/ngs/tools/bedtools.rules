# -*- snakemake -*-
import os
from snakemakelib.config import update_sml_config, sml_rules_path, get_sml_config

# Start by including the general snakefile
include: os.path.join(sml_rules_path(), 'bio/ngs', 'settings.rules')

sml_config = get_sml_config()

config_default = { 
    'bio.ngs.tools.bedtools' : {
        'home' : ".",
        'bfile' : "",
        'options' : "",
        'coveragebed' : {
            'cmd' : 'coverageBed',
        },
    },
}

update_sml_config(config_default)

sml_config = get_sml_config()

bedtools_config = sml_config['bio.ngs.tools.bedtools']

rule bedtools_bam2coverage:
    """Calculate coverage for a bam file.

    Input: {prefix}.bam; output: {prefix}.coverage
    """
    params: cmd=os.path.join(bedtools_config['home'], bedtools_config['coveragebed']['cmd']),
            options=bedtools_config['options'],
            bfile = bedtools_config['bfile']
    input: "{prefix}.bam"
    output: "{prefix}.coverage"
    shell: "{params.cmd} {params.options} -abam {input} -b {params.bfile} > {output}"
